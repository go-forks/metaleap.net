<h1>GL/Go code checker</h1>
<p>Getting seriously tricky stuff done in Go is, time and again, surprisingly simple:</p>
<p>Here's an interesting "convoluted custom use-case" I just had while working on <a href="http://github.com/metaleap/go-ngine">go:ngine</a>. So the engine is supposed to support OpenGL versions 3.2 or higher, but during development, 99% of the time I just run under OpenGL 4.2. To stay in the flow, I don't want to consult the GL specs every time I use a GL function or enumeration. At the same time, when I push to GitHub, I'd like to make sure any and all GL function or enumeration references in all go:ngine sources are either GL 3.2 or lower, or else wrapped in some conditional logic (ie. "only go ahead here if client GL version supports it")...</p>
<p>So for talking to OpenGL, go:ngine uses the <a href="http://github.com/chsc/gogl">fantastic GoGL binding</a>. Specifically it uses the <strong>gl42</strong> sub-package -- don't worry, that package even works under OpenGL 3.2! --- at least, <strong>if</strong> we <em>(A)</em> ignore the version-related error (but not any other kind of error) returned by <code>gl42.Init()</code> and <em>(B)</em> ensure we don't use API functions or enum values newer than the detected run-time GL version. So part <em>(A)</em> is easy, but ensuring <em>(B)</em> at all times (when mostly I happily develop using just my 4.2-capable GPU) could over time become an issue. What to do?<br/></p>
{X|h2: Ideally:  a simple code checker |}
<p>that I would run just occasionally -- every other week, or right before major commits. It would:</p>
<ol><li>run over the entire go:ngine code-base</li><li>for each <em>.go</em> source file, collect all its references to the <strong>gl42</strong> package<br/></li><li>record the name of every <strong>gl42</strong> function or enum value referenced (ignoring GL types here since from what I gather none have been added ever since 3.2)<br/></li><li>then for each such tracked reference, check a <a href="http://bitbucket.org/alfonse/gl-xml-specs/downloads">GL Specification XML file</a> for the minimum version that would support it<br/></li><li>if the version for the func/enum reference is 3.2 or lower, ignore it</li><li>otherwise, keep it and later show a summary like this:</li></ol>
<pre>GL v4.2 used 4x:<br/>&nbsp;&nbsp;&nbsp; function TexStorage2D:<br/>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; c:\gd\src\github.com\metaleap\go-opengl\util\gl\buffers.go<br/>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; c:\gd\src\github.com\metaleap\go-opengl\util\gl\textures.go<br/>&nbsp;&nbsp;&nbsp; function TexStorage3D:<br/>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; c:\gd\src\github.com\metaleap\go-opengl\util\gl\textures.go<br/>&nbsp;&nbsp;&nbsp; enum ATOMIC_COUNTER_BUFFER:<br/>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; c:\gd\src\github.com\metaleap\go-opengl\util\gl\buffers.go<br/>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; c:\gd\src\github.com\metaleap\go-opengl\util\gl\counters.go<br/>&nbsp;&nbsp;&nbsp; function TexStorage1D:<br/>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; c:\gd\src\github.com\metaleap\go-opengl\util\gl\textures.go<br/>GL v4.0 used 2x:<br/>&nbsp;&nbsp;&nbsp; enum TESS_CONTROL_SHADER:<br/>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; c:\gd\src\github.com\metaleap\go-ngine\client\glcore\shaders.go<br/>&nbsp;&nbsp;&nbsp; enum TESS_EVALUATION_SHADER:<br/>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; c:\gd\src\github.com\metaleap\go-ngine\client\glcore\shaders.go</pre>
<p>The above is actually real output of said tool, because I just wrote it today in just a few hours and guess what..</p>
{X|h2: ..only a 100 lines or so in total! |}
<p>That's why I find Go amazingly fun to work with... (OK,&nbsp; maybe JavaScript could have done all this half the space, but I like statically-typed native-compiled code so anyway and Go's strict compiler saved me from a few bugs just right there today.)<br/></p>
<ul>
	<li>Parsing all <em>.go</em> source files was surprisingly simple just working off the <a href="http://golang.org/pkg/go/ast/">go/ast</a> and <a href="http://golang.org/pkg/go/parser/">go/parser</a> package examples.</li>
	<li> Parsing the XML GL-specification file using the <a href="http://golang.org/pkg/encoding/xml/">encoding/xml</a> package <strong>would have been a major pain point</strong>, but before even taking the trouble to write out all XML tags as Go structs (I didn't <em>really</em> want to "unmarshal" anything, thanks very much...), I luckily came across the awesome <a href="http://github.com/jteeuwen/go-pkg-xmlx">go-pkg-xmlx</a> package -- it made loading and searching the 1.4MB spec file painless and also crucially, <strong>Just-Worked</strong> right off the bat! Kudos to <a href="http://github.com/jteeuwen/">jteeuwen</a>, once again great work and a superb contribution to the Go eco-system. (go:ngine also uses his <a href="http://github.com/go-gl/glfw">Go GLFW binding</a>, which also works a <em>charm</em> across platforms. Yay!)<br/></li>
</ul>
<p>If you wanna see (or use) the code to parse the .go source tree, load the XML spec and checks any and all <strong>gogl/gl42</strong> references across a given code-base against specific OpenGL versions, <a href="https://github.com/metaleap/go-ngine/tree/master/___old2013/_tools/buildtools/ng-gogl-imp-version-checker">it's right here on GitHub</a>.</p>
